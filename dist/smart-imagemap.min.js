/*! Smart Imagemap - v0.1.0 - 2012-09-25
* https://github.com/xat/smart-imagemap
* Copyright (c) 2012 Simon Kusterer; Licensed MIT */
(function(a){var b=function(b){this.$image=b,this.image=b.get(0),this.STATES={READY:0,NOTREADY:1},this.state=this.STATES.NOTREADY;if(!this.prepareMap())return;if(!this.prepareAreas())return;this.prepareDimensions(),this.$image.on("smartimagemap.update",a.proxy(this.update,this))};b.prototype.prepareDimensions=function(){var b=this;a("<img/>").load(function(){var c=a(this).get(0);b.orgWidth=c.width,b.orgHeight=c.height,b.state=b.STATES.READY,b.update()}).attr("src",this.$image.attr("src"))},b.prototype.update=function(){if(this.state!==this.STATES.READY)return;var b=this.$image.width()/this.orgWidth,c=this.$image.height()/this.orgHeight;if(b===1&&c===1)return;this.$areas.each(function(){var d=a(this),e="",f=d.data("smartimagemap.meta");a.each(f.initcoords,function(a,d){a!==0&&(e=e.concat(",")),e=e.concat((d.x*b).toString(),",",(d.y*c).toString())}),typeof f.radius!="undefined"&&(e=e.concat(",",f.radius.toString())),d.attr("coords",e)})},b.prototype.prepareAreas=function(){return this.$areas=this.$map.find("area").filter('[shape!="default"]'),this.$areas.each(function(){var b=a(this),c=b.attr("coords").split(","),d=[];if(c.length===0)return 0;a.each(c,function(a,b){b=b.trim(),a%2&&d.push({x:parseFloat(c[a-1]),y:parseFloat(b)})});var e={initcoords:d,initcoordsstring:b.attr("coords")};b.attr("shape")==="circle"&&(e.radius=parseFloat(c[c.length-1])),b.data("smartimagemap.meta",e)}),this.$areas.length},b.prototype.prepareMap=function(){var b=this.$image.attr("usemap");if(typeof b!="string")return!1;if(b.length<=2)return!1;if(b.substr(0,1)!=="#")return!1;var c=b.substr(1);return this.$map=a('map[name="'+c+'"]'),this.$map.length>0},a.fn.smartImagemap=function(){return this.each(function(){a(this).data("smartimagemap",new b(a(this)))})}})(jQuery);